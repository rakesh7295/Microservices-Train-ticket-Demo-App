<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RoutePlanServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ts-route-plan-service</a> &gt; <a href="index.source.html" class="el_package">plan.service</a> &gt; <span class="el_source">RoutePlanServiceImpl.java</span></div><h1>RoutePlanServiceImpl.java</h1><pre class="source lang-java linenums">package plan.service;

import edu.fudan.common.util.Response;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import plan.entity.*;

import java.util.ArrayList;
import java.util.List;

/**
 * @author fdse
 */
@Service
<span class="fc" id="L23">public class RoutePlanServiceImpl implements RoutePlanService {</span>

    @Autowired
    private RestTemplate restTemplate;
<span class="fc" id="L27">    private static final Logger LOGGER = LoggerFactory.getLogger(RoutePlanServiceImpl.class);</span>

    @Override
    public Response searchCheapestResult(RoutePlanInfo info, HttpHeaders headers) {

        //1.Violence pulls out all the results of travel-service and travle2-service
<span class="fc" id="L33">        TripInfo queryInfo = new TripInfo();</span>
<span class="fc" id="L34">        queryInfo.setStartingPlace(info.getFormStationName());</span>
<span class="fc" id="L35">        queryInfo.setEndPlace(info.getToStationName());</span>
<span class="fc" id="L36">        queryInfo.setDepartureTime(info.getTravelDate());</span>

<span class="fc" id="L38">        ArrayList&lt;TripResponse&gt; highSpeed = getTripFromHighSpeedTravelServive(queryInfo, headers);</span>
<span class="fc" id="L39">        ArrayList&lt;TripResponse&gt; normalTrain = getTripFromNormalTrainTravelService(queryInfo, headers);</span>

        //2.Sort by second-class seats
<span class="fc" id="L42">        ArrayList&lt;TripResponse&gt; finalResult = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L43">        finalResult.addAll(highSpeed);</span>
<span class="fc" id="L44">        finalResult.addAll(normalTrain);</span>

        float minPrice;
<span class="fc" id="L47">        int minIndex = -1;</span>
<span class="fc" id="L48">        int size = Math.min(5, finalResult.size());</span>
<span class="fc" id="L49">        ArrayList&lt;TripResponse&gt; returnResult = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">        for (int i = 0; i &lt; size; i++) {</span>

<span class="nc" id="L52">            minPrice = Float.MAX_VALUE;</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">            for (int j = 0; j &lt; finalResult.size(); j++) {</span>
<span class="nc" id="L54">                TripResponse thisRes = finalResult.get(j);</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">                if (Float.parseFloat(thisRes.getPriceForEconomyClass()) &lt; minPrice) {</span>
<span class="nc" id="L56">                    minPrice = Float.parseFloat(finalResult.get(j).getPriceForEconomyClass());</span>
<span class="nc" id="L57">                    minIndex = j;</span>
                }
            }
<span class="nc" id="L60">            returnResult.add(finalResult.get(minIndex));</span>
<span class="nc" id="L61">            finalResult.remove(minIndex);</span>
        }


<span class="fc" id="L65">        ArrayList&lt;RoutePlanResultUnit&gt; units = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">        for (int i = 0; i &lt; returnResult.size(); i++) {</span>
<span class="nc" id="L67">            TripResponse tempResponse = returnResult.get(i);</span>

<span class="nc" id="L69">            RoutePlanResultUnit tempUnit = new RoutePlanResultUnit();</span>
<span class="nc" id="L70">            tempUnit.setTripId(tempResponse.getTripId().toString());</span>
<span class="nc" id="L71">            tempUnit.setTrainTypeId(tempResponse.getTrainTypeId());</span>
<span class="nc" id="L72">            tempUnit.setFromStationName(tempResponse.getStartingStation());</span>
<span class="nc" id="L73">            tempUnit.setToStationName(tempResponse.getTerminalStation());</span>
<span class="nc" id="L74">            tempUnit.setStopStations(getStationList(tempResponse.getTripId().toString(), headers));</span>
<span class="nc" id="L75">            tempUnit.setPriceForSecondClassSeat(tempResponse.getPriceForEconomyClass());</span>
<span class="nc" id="L76">            tempUnit.setPriceForFirstClassSeat(tempResponse.getPriceForConfortClass());</span>
<span class="nc" id="L77">            tempUnit.setEndTime(tempResponse.getEndTime());</span>
<span class="nc" id="L78">            tempUnit.setStartingTime(tempResponse.getStartingTime());</span>

<span class="nc" id="L80">            units.add(tempUnit);</span>
        }

<span class="fc" id="L83">        return new Response&lt;&gt;(1, &quot;Success&quot;, units);</span>
    }

    @Override
    public Response searchQuickestResult(RoutePlanInfo info, HttpHeaders headers) {

        //1.Violence pulls out all the results of travel-service and travle2-service
<span class="fc" id="L90">        TripInfo queryInfo = new TripInfo();</span>
<span class="fc" id="L91">        queryInfo.setStartingPlace(info.getFormStationName());</span>
<span class="fc" id="L92">        queryInfo.setEndPlace(info.getToStationName());</span>
<span class="fc" id="L93">        queryInfo.setDepartureTime(info.getTravelDate());</span>

<span class="fc" id="L95">        ArrayList&lt;TripResponse&gt; highSpeed = getTripFromHighSpeedTravelServive(queryInfo, headers);</span>
<span class="fc" id="L96">        ArrayList&lt;TripResponse&gt; normalTrain = getTripFromNormalTrainTravelService(queryInfo, headers);</span>

        //2.Sort by time
<span class="fc" id="L99">        ArrayList&lt;TripResponse&gt; finalResult = new ArrayList&lt;&gt;();</span>

<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        for (TripResponse tr : highSpeed) {</span>
<span class="nc" id="L102">            finalResult.add(tr);</span>
<span class="nc" id="L103">        }</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        for (TripResponse tr : normalTrain) {</span>
<span class="nc" id="L105">            finalResult.add(tr);</span>
<span class="nc" id="L106">        }</span>

        long minTime;
<span class="fc" id="L109">        int minIndex = -1;</span>
<span class="fc" id="L110">        int size = Math.min(finalResult.size(), 5);</span>
<span class="fc" id="L111">        ArrayList&lt;TripResponse&gt; returnResult = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">        for (int i = 0; i &lt; size; i++) {</span>

<span class="nc" id="L114">            minTime = Long.MAX_VALUE;</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">            for (int j = 0; j &lt; finalResult.size(); j++) {</span>
<span class="nc" id="L116">                TripResponse thisRes = finalResult.get(j);</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">                if (thisRes.getEndTime().getTime() - thisRes.getStartingTime().getTime() &lt; minTime) {</span>
<span class="nc" id="L118">                    minTime = thisRes.getEndTime().getTime() - thisRes.getStartingTime().getTime();</span>
<span class="nc" id="L119">                    minIndex = j;</span>
                }
            }
<span class="nc" id="L122">            returnResult.add(finalResult.get(minIndex));</span>
<span class="nc" id="L123">            finalResult.remove(minIndex);</span>

        }


<span class="fc" id="L128">        ArrayList&lt;RoutePlanResultUnit&gt; units = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">        for (int i = 0; i &lt; returnResult.size(); i++) {</span>
<span class="nc" id="L130">            TripResponse tempResponse = returnResult.get(i);</span>

<span class="nc" id="L132">            RoutePlanResultUnit tempUnit = new RoutePlanResultUnit();</span>
<span class="nc" id="L133">            tempUnit.setTripId(tempResponse.getTripId().toString());</span>
<span class="nc" id="L134">            tempUnit.setTrainTypeId(tempResponse.getTrainTypeId());</span>
<span class="nc" id="L135">            tempUnit.setFromStationName(tempResponse.getStartingStation());</span>
<span class="nc" id="L136">            tempUnit.setToStationName(tempResponse.getTerminalStation());</span>

<span class="nc" id="L138">            tempUnit.setStopStations(getStationList(tempResponse.getTripId().toString(), headers));</span>

<span class="nc" id="L140">            tempUnit.setPriceForSecondClassSeat(tempResponse.getPriceForEconomyClass());</span>
<span class="nc" id="L141">            tempUnit.setPriceForFirstClassSeat(tempResponse.getPriceForConfortClass());</span>
<span class="nc" id="L142">            tempUnit.setStartingTime(tempResponse.getStartingTime());</span>
<span class="nc" id="L143">            tempUnit.setEndTime(tempResponse.getEndTime());</span>
<span class="nc" id="L144">            units.add(tempUnit);</span>
        }
<span class="fc" id="L146">        return new Response&lt;&gt;(1, &quot;Success&quot;, units);</span>
    }

    @Override
    public Response searchMinStopStations(RoutePlanInfo info, HttpHeaders headers) {
<span class="fc" id="L151">        String fromStationId = queryForStationId(info.getFormStationName(), headers);</span>
<span class="fc" id="L152">        String toStationId = queryForStationId(info.getToStationName(), headers);</span>
<span class="fc" id="L153">        RoutePlanServiceImpl.LOGGER.info(&quot;From Id: {} To: {}&quot;, fromStationId , toStationId);</span>
        //1.Get the route through the two stations

<span class="fc" id="L156">        HttpEntity requestEntity = new HttpEntity(headers);</span>
<span class="fc" id="L157">        ResponseEntity&lt;Response&lt;ArrayList&lt;Route&gt;&gt;&gt; re = restTemplate.exchange(</span>
                &quot;http://ts-route-service:11178/api/v1/routeservice/routes/&quot; + fromStationId + &quot;/&quot; + toStationId,
                HttpMethod.GET,
                requestEntity,
<span class="fc" id="L161">                new ParameterizedTypeReference&lt;Response&lt;ArrayList&lt;Route&gt;&gt;&gt;() {</span>
                });


<span class="fc" id="L165">        ArrayList&lt;Route&gt; routeList = re.getBody().getData();</span>
<span class="fc" id="L166">        RoutePlanServiceImpl.LOGGER.info(&quot;[Route Plan Service] Candidate Route Number: {}&quot;, routeList.size());</span>
        //2.Calculate how many stops there are between the two stations
<span class="fc" id="L168">        ArrayList&lt;Integer&gt; gapList = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L169" title="1 of 2 branches missed.">        for (int i = 0; i &lt; routeList.size(); i++) {</span>
<span class="nc" id="L170">            int indexStart = routeList.get(i).getStations().indexOf(fromStationId);</span>
<span class="nc" id="L171">            int indexEnd = routeList.get(i).getStations().indexOf(toStationId);</span>
<span class="nc" id="L172">            gapList.add(indexEnd - indexStart);</span>
        }
        //3.Pick the routes with the fewest stops
<span class="fc" id="L175">        ArrayList&lt;String&gt; resultRoutes = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L176">        int size = Math.min(5, routeList.size());</span>
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">        for (int i = 0; i &lt; size; i++) {</span>
<span class="nc" id="L178">            int minIndex = 0;</span>
<span class="nc" id="L179">            int tempMinGap = Integer.MAX_VALUE;</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">            for (int j = 0; j &lt; gapList.size(); j++) {</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">                if (gapList.get(j) &lt; tempMinGap) {</span>
<span class="nc" id="L182">                    tempMinGap = gapList.get(j);</span>
<span class="nc" id="L183">                    minIndex = j;</span>
                }
            }
<span class="nc" id="L186">            resultRoutes.add(routeList.get(minIndex).getId());</span>
<span class="nc" id="L187">            routeList.remove(minIndex);</span>
<span class="nc" id="L188">            gapList.remove(minIndex);</span>
        }
        //4.Depending on the route, go to travel-service or travel2service to get the train information
<span class="fc" id="L191">        requestEntity = new HttpEntity(resultRoutes, headers);</span>
<span class="fc" id="L192">        ResponseEntity&lt;Response&lt;ArrayList&lt;ArrayList&lt;Trip&gt;&gt;&gt;&gt; re2 = restTemplate.exchange(</span>
                &quot;http://ts-travel-service:12346/api/v1/travelservice/trips/routes&quot;,
                HttpMethod.POST,
                requestEntity,
<span class="fc" id="L196">                new ParameterizedTypeReference&lt;Response&lt;ArrayList&lt;ArrayList&lt;Trip&gt;&gt;&gt;&gt;() {</span>
                });

<span class="fc" id="L199">        ArrayList&lt;ArrayList&lt;Trip&gt;&gt; travelTrips = re2.getBody().getData();</span>


<span class="fc" id="L202">        re2 = restTemplate.exchange(</span>
                &quot;http://ts-travel2-service:16346/api/v1/travel2service/trips/routes&quot;,
                HttpMethod.POST,
                requestEntity,
<span class="fc" id="L206">                new ParameterizedTypeReference&lt;Response&lt;ArrayList&lt;ArrayList&lt;Trip&gt;&gt;&gt;&gt;() {</span>
                });
<span class="fc" id="L208">        ArrayList&lt;ArrayList&lt;Trip&gt;&gt; travel2Trips = re2.getBody().getData();</span>

        //Merge query results
<span class="fc" id="L211">        ArrayList&lt;ArrayList&lt;Trip&gt;&gt; finalTripResult = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        for (int i = 0; i &lt; travel2Trips.size(); i++) {</span>
<span class="nc" id="L213">            ArrayList&lt;Trip&gt; tempList = travel2Trips.get(i);</span>
<span class="nc" id="L214">            tempList.addAll(travelTrips.get(i));</span>
<span class="nc" id="L215">            finalTripResult.add(tempList);</span>
        }
<span class="fc" id="L217">        RoutePlanServiceImpl.LOGGER.info(&quot;[Route Plan Service] Trips Num: {}&quot;, finalTripResult.size());</span>
        //5.Then, get the price and the station information according to the train information
<span class="fc" id="L219">        ArrayList&lt;Trip&gt; trips = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        for (ArrayList&lt;Trip&gt; tempTrips : finalTripResult) {</span>
<span class="nc" id="L221">            trips.addAll(tempTrips);</span>
<span class="nc" id="L222">        }</span>
<span class="fc" id="L223">        ArrayList&lt;RoutePlanResultUnit&gt; tripResponses = new ArrayList&lt;&gt;();</span>

        ResponseEntity&lt;Response&lt;TripAllDetail&gt;&gt; re3;
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">        for (Trip trip : trips) {</span>
            TripResponse tripResponse;
<span class="nc" id="L228">            TripAllDetailInfo allDetailInfo = new TripAllDetailInfo();</span>
<span class="nc" id="L229">            allDetailInfo.setTripId(trip.getTripId().toString());</span>
<span class="nc" id="L230">            allDetailInfo.setTravelDate(info.getTravelDate());</span>
<span class="nc" id="L231">            allDetailInfo.setFrom(info.getFormStationName());</span>
<span class="nc" id="L232">            allDetailInfo.setTo(info.getToStationName());</span>
<span class="nc" id="L233">            requestEntity = new HttpEntity(allDetailInfo, headers);</span>
<span class="nc" id="L234">            String requestUrl = &quot;&quot;;</span>
<span class="nc bnc" id="L235" title="All 4 branches missed.">            if (trip.getTripId().toString().charAt(0) == 'D' || trip.getTripId().toString().charAt(0) == 'G') {</span>
<span class="nc" id="L236">                requestUrl = &quot;http://ts-travel-service:12346/api/v1/travelservice/trip_detail&quot;;</span>
            } else {
<span class="nc" id="L238">                requestUrl = &quot;http://ts-travel2-service:16346/api/v1/travel2service/trip_detail&quot;;</span>
            }
<span class="nc" id="L240">            re3 = restTemplate.exchange(</span>
                    requestUrl,
                    HttpMethod.POST,
                    requestEntity,
<span class="nc" id="L244">                    new ParameterizedTypeReference&lt;Response&lt;TripAllDetail&gt;&gt;() {</span>
                    });

<span class="nc" id="L247">            TripAllDetail tripAllDetail = re3.getBody().getData();</span>
<span class="nc" id="L248">            tripResponse = tripAllDetail.getTripResponse();</span>


<span class="nc" id="L251">            RoutePlanResultUnit unit = new RoutePlanResultUnit();</span>
<span class="nc" id="L252">            unit.setTripId(trip.getTripId().toString());</span>
<span class="nc" id="L253">            unit.setTrainTypeId(tripResponse.getTrainTypeId());</span>
<span class="nc" id="L254">            unit.setFromStationName(tripResponse.getStartingStation());</span>
<span class="nc" id="L255">            unit.setToStationName(tripResponse.getTerminalStation());</span>
<span class="nc" id="L256">            unit.setStartingTime(tripResponse.getStartingTime());</span>
<span class="nc" id="L257">            unit.setEndTime(tripResponse.getEndTime());</span>
<span class="nc" id="L258">            unit.setPriceForFirstClassSeat(tripResponse.getPriceForConfortClass());</span>
<span class="nc" id="L259">            unit.setPriceForSecondClassSeat(tripResponse.getPriceForEconomyClass());</span>
            //Go get the roadmap according to routeid
<span class="nc" id="L261">            String routeId = trip.getRouteId();</span>
<span class="nc" id="L262">            Route tripRoute = getRouteByRouteId(routeId, headers);</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">            if (tripRoute != null) {</span>
<span class="nc" id="L264">                unit.setStopStations(tripRoute.getStations());</span>
            }

<span class="nc" id="L267">            tripResponses.add(unit);</span>
<span class="nc" id="L268">        }</span>
<span class="fc" id="L269">        RoutePlanServiceImpl.LOGGER.info(&quot;[Route Plan Service] Trips Response Unit Num: {}&quot;, tripResponses.size());</span>
<span class="fc" id="L270">        return new Response&lt;&gt;(1, &quot;Success.&quot;, tripResponses);</span>
    }

    private String queryForStationId(String stationName, HttpHeaders headers) {
<span class="fc" id="L274">        RoutePlanServiceImpl.LOGGER.info(&quot;[Preserve Service][Get Station Name]&quot;);</span>

<span class="fc" id="L276">        HttpEntity requestEntity = new HttpEntity(headers);</span>
<span class="fc" id="L277">        ResponseEntity&lt;Response&lt;String&gt;&gt; re = restTemplate.exchange(</span>
                &quot;http://ts-station-service:12345/api/v1/stationservice/stations/id/&quot; + stationName,
                HttpMethod.GET,
                requestEntity,
<span class="fc" id="L281">                new ParameterizedTypeReference&lt;Response&lt;String&gt;&gt;() {</span>
                });
<span class="fc" id="L283">        return re.getBody().getData();</span>
    }

    private Route getRouteByRouteId(String routeId, HttpHeaders headers) {
<span class="nc" id="L287">        RoutePlanServiceImpl.LOGGER.info(&quot;[Route Plan Service][Get Route By Id] Route ID：{}&quot;, routeId);</span>
<span class="nc" id="L288">        HttpEntity requestEntity = new HttpEntity(headers);</span>
<span class="nc" id="L289">        ResponseEntity&lt;Response&lt;Route&gt;&gt; re = restTemplate.exchange(</span>
                &quot;http://ts-route-service:11178/api/v1/routeservice/routes/&quot; + routeId,
                HttpMethod.GET,
                requestEntity,
<span class="nc" id="L293">                new ParameterizedTypeReference&lt;Response&lt;Route&gt;&gt;() {</span>
                });
<span class="nc" id="L295">        Response&lt;Route&gt; result = re.getBody();</span>

<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (result.getStatus() == 0) {</span>
<span class="nc" id="L298">            RoutePlanServiceImpl.LOGGER.info(&quot;[Travel Service][Get Route By Id] Fail. {}&quot;, result.getMsg());</span>
<span class="nc" id="L299">            return null;</span>
        } else {
<span class="nc" id="L301">            RoutePlanServiceImpl.LOGGER.info(&quot;[Travel Service][Get Route By Id] Success.&quot;);</span>
<span class="nc" id="L302">            return result.getData();</span>
        }
    }

    private ArrayList&lt;TripResponse&gt; getTripFromHighSpeedTravelServive(TripInfo info, HttpHeaders headers) {
<span class="fc" id="L307">        HttpEntity requestEntity = new HttpEntity(info, headers);</span>

<span class="fc" id="L309">        ResponseEntity&lt;Response&lt;ArrayList&lt;TripResponse&gt;&gt;&gt; re = restTemplate.exchange(</span>
                &quot;http://ts-travel-service:12346/api/v1/travelservice/trips/left&quot;,
                HttpMethod.POST,
                requestEntity,
<span class="fc" id="L313">                new ParameterizedTypeReference&lt;Response&lt;ArrayList&lt;TripResponse&gt;&gt;&gt;() {</span>
                });

<span class="fc" id="L316">        ArrayList&lt;TripResponse&gt; tripResponses = re.getBody().getData();</span>
<span class="fc" id="L317">        RoutePlanServiceImpl.LOGGER.info(&quot;[Route Plan Get Trip][Size] {}&quot;, tripResponses.size());</span>
<span class="fc" id="L318">        return tripResponses;</span>
    }

    private ArrayList&lt;TripResponse&gt; getTripFromNormalTrainTravelService(TripInfo info, HttpHeaders headers) {
<span class="fc" id="L322">        HttpEntity requestEntity = new HttpEntity(info, headers);</span>

<span class="fc" id="L324">        ResponseEntity&lt;Response&lt;ArrayList&lt;TripResponse&gt;&gt;&gt; re = restTemplate.exchange(</span>
                &quot;http://ts-travel2-service:16346/api/v1/travel2service/trips/left&quot;,
                HttpMethod.POST,
                requestEntity,
<span class="fc" id="L328">                new ParameterizedTypeReference&lt;Response&lt;ArrayList&lt;TripResponse&gt;&gt;&gt;() {</span>
                });
<span class="fc" id="L330">        ArrayList&lt;TripResponse&gt; list = re.getBody().getData();</span>
<span class="fc" id="L331">        RoutePlanServiceImpl.LOGGER.info(&quot;[Route Plan Get TripOther][Size] {}&quot;, list.size());</span>
<span class="fc" id="L332">        return list;</span>
    }

    private List&lt;String&gt; getStationList(String tripId, HttpHeaders headers) {

        String path;
<span class="nc bnc" id="L338" title="All 4 branches missed.">        if (tripId.charAt(0) == 'G' || tripId.charAt(0) == 'D') {</span>
<span class="nc" id="L339">            path = &quot;http://ts-travel-service:12346/api/v1/travelservice/routes/&quot; + tripId;</span>
        } else {
<span class="nc" id="L341">            path = &quot;http://ts-travel2-service:16346/api/v1/travel2service/routes/&quot; + tripId;</span>
        }
<span class="nc" id="L343">        HttpEntity requestEntity = new HttpEntity(headers);</span>
<span class="nc" id="L344">        ResponseEntity&lt;Response&lt;Route&gt;&gt; re = restTemplate.exchange(</span>
                path,
                HttpMethod.GET,
                requestEntity,
<span class="nc" id="L348">                new ParameterizedTypeReference&lt;Response&lt;Route&gt;&gt;() {</span>
                });
<span class="nc" id="L350">        Route route = re.getBody().getData();</span>
<span class="nc" id="L351">        return route.getStations();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>